script:

  all_lights_off_but_pandora:
    alias: "Turn off all lights but Pandora if Pe is home"
    sequence:
      - service: light.turn_off
        entity_id: group.all_lights
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
      - service: light.turn_on
        entity_id: light.pandora

automation:

  - alias: "Autolight All Off"
    trigger:
      - platform: time
        at: '00:01:00'
    condition:
      - condition: template
        value_template: '{{ not is_state("input_select.homemode", "Visitor") }}'
    action:
      - service: script.all_lights_off_but_pandora
      - service: script.notifying
        data:
          email: "false"
          tv: "true"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "All lights are off after midnight"
          message: 'All lights are off after midnight [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Sunset Home A"
    trigger:
      - platform: sun
        event: sunset
        offset: "-00:15:00"
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") }}'
    action:
      - service: light.turn_on
        entity_id: light.lightstrip
        data:
          transition: 5
          brightness: 200
          xy_color: [0.1794, 0.0964]
      - service: script.notifying
        data:
          email: "false"
          tv: "true"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Lightstrip has been turned on 15 minutes before sunset"
          message: 'Lightstrip has been turned on 15 minutes before sunset [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Sunset Home B"
    trigger:
      - platform: sun
        event: sunset
        offset: "+01:00:00"
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") }}'
    action:
      - service: light.turn_off
        entity_id: light.lightstrip
      - service: script.notifying
        data:
          email: "false"
          tv: "true"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Lightstrip has been turned off 1.5 hours after sunset"
          message: 'Lightstrip has been turned off 1.5 hours after sunset [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Sunset Away A"
    trigger:
      - platform: sun
        event: sunset
        offset: "-00:15:00"
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_on
        entity_id: light.garage
        data:
          transition: 5
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Garage light has been turned on 15 minutes before sunset"
          message: 'Garage light has been turned on 15 minutes before sunset [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Sunset Away B"
    trigger:
      - platform: sun
        event: sunset
        offset: "+01:00:00"
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_off
        entity_id: light.garage
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Garage light has been turned off 1.5 hours after sunset"
          message: 'Garage light has been turned off 1.5 hours after sunset [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Home 1A"
    trigger:
      - platform: time
        at: '19:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") }}'
    action:
      - service: light.turn_on
        entity_id: light.front_1
        data:
          transition: 5
          brightness: 200
      - service: script.notifying
        data:
          email: "false"
          tv: "true"
          speak: "true"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Downstairs Light has been turned on at 19:30pm for home-mode"
          message: 'Downstairs Light has been turned on at 19:30pm for home-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Home 1B"
    trigger:
      - platform: time
        at: '20:00:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") }}'
    action:
      - service: light.turn_off
        entity_id: light.front_1
      - service: script.notifying
        data:
          email: "false"
          tv: "true"
          speak: "true"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Downstairs Light has been turned off at 20:00pm for home-mode"
          message: 'Downstairs Light has been turned off at 20:00pm for home-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Home 2A"
    trigger:
      - platform: time
        at: '21:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") }}'
    action:
      - service: light.turn_on
        entity_id: light.bedroom_lw
        data:
          transition: 5
          brightness: 100
      - service: script.notifying
        data:
          email: "false"
          tv: "true"
          speak: "true"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Bedroom LW has been turned on at 21:30pm for home-mode"
          message: 'Bedroom LW has been turned on at 21:30pm for home-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Home 2B"
    trigger:
      - platform: time
        at: '23:15:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") }}'
    action:
      - service: light.turn_off
        entity_id: light.bedroom_lw
      - service: script.notifying
        data:
          email: "false"
          tv: "true"
          speak: "true"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Bedroom LW has been turned off at 23:15pm for home-mode"
          message: 'Bedroom LW has been turned off at 23:15pm for home-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 1A"
    trigger:
      - platform: time
        at: '19:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_on
        entity_id: light.garage
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Garage Light has been turned on at 19:30pm for away-mode"
          message: 'Garage Light has been turned on at 19:30pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 1B"
    trigger:
      - platform: time
        at: '20:15:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_off
        entity_id: light.garage
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Garage Light has been turned off at 20:15pm for away-mode"
          message: 'Garage Light has been turned off at 20:15pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 2A"
    trigger:
      - platform: time
        at: '20:00:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_on
        entity_id: light.front_2
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Downstairs Light has been turned on at 20:00pm for away-mode"
          message: 'Downstairs Light has been turned on at 20:00pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 2B"
    trigger:
      - platform: time
        at: '20:45:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_off
        entity_id: light.front_2
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Downstairs Light has been turned off at 20:45pm for away-mode"
          message: 'Downstairs Light has been turned off at 20:45pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 3A"
    trigger:
      - platform: time
        at: '21:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_on
        entity_id: light.bedroom_lw
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Bedroom LW has been turned on at 21:30pm for away-mode"
          message: 'Bedroom LW has been turned on at 21:30pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 3B"
    trigger:
      - platform: time
        at: '22:00:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_off
        entity_id: light.bedroom_lw
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Bedroom LW has been turned off at 22:00pm for away-mode"
          message: 'Bedroom LW has been turned off at 22:00pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 4A"
    trigger:
      - platform: time
        at: '22:40:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_on
        entity_id: light.bedroom_lw
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Bedroom LW has been turned on at 22:40pm for away-mode"
          message: 'Bedroom LW has been turned on at 22:40pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Away 4B"
    trigger:
      - platform: time
        at: '23:10:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Away") }}'
    action:
      - service: light.turn_off
        entity_id: light.bedroom_lw
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "false"
          title: "Bedroom LW has been turned off at 23:10pm for away-mode"
          message: 'Bedroom LW has been turned off at 23:10pm for away-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 1A"
    trigger:
      - platform: time
        at: '19:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_on
        entity_id: light.garage
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Garage Light has been turned on at 19:30pm for vacation-mode"
          message: 'Garage Light has been turned on at 19:30pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 1B"
    trigger:
      - platform: time
        at: '20:00:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_off
        entity_id: light.garage
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Garage Light has been turned off at 20:00pm for vacation-mode"
          message: 'Garage Light has been turned off at 20:00pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 2A"
    trigger:
      - platform: time
        at: '20:15:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_on
        entity_id: light.front_2
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Downstairs Light has been turned on at 20:15pm for vacation-mode"
          message: 'Downstairs Light has been turned on at 20:15pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 2B"
    trigger:
      - platform: time
        at: '20:55:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_off
        entity_id: light.front_2
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Downstairs Light has been turned off at 20:55pm for vacation-mode"
          message: 'Downstairs Light has been turned off at 20:55pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 3A"
    trigger:
      - platform: time
        at: '21:15:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_on
        entity_id: light.common_room_1
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Common Room 1 has been turned on at 21:15pm for vacation-mode"
          message: 'Common Room 1 has been turned on at 21:15pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 3B"
    trigger:
      - platform: time
        at: '21:45:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_off
        entity_id: light.common_room_1
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Common Room 1 has been turned off at 21:45pm for vacation-mode"
          message: 'Common Room 1 has been turned off at 21:45pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 4A"
    trigger:
      - platform: time
        at: '22:00:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_on
        entity_id: light.bedroom_lw
        data:
          transition: 1
          brightness: 255
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Bedroom LW has been turned on at 22:00pm for vacation-mode"
          message: 'Bedroom LW has been turned on at 22:00pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Vacation 4B"
    trigger:
      - platform: time
        at: '22:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Vacation") }}'
    action:
      - service: light.turn_off
        entity_id: light.bedroom_lw
      - service: script.notifying
        data:
          email: "true"
          tv: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          title: "Bedroom LW has been turned off at 22:30pm for vacation-mode"
          message: 'Bedroom LW has been turned off at 22:30pm for vacation-mode [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'

  - alias: "Autolight Pe Home Bedroom 1A"
    trigger:
      - platform: time
        at: '18:00:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: light.turn_on
        entity_id: light.pandora

  - alias: "Autolight Pe Home Bedroom 1B"
    trigger:
      - platform: time
        at: '19:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: light.turn_off
        entity_id: light.pandora

  - alias: "Autolight Pe Home Bedroom 2A"
    trigger:
      - platform: time
        at: '22:30:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: light.turn_on
        entity_id: light.pandora

  - alias: "Autolight Pe Home Bedroom 2B"
    trigger:
      - platform: time
        at: '23:00:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: light.turn_off
        entity_id: light.pandora

  - alias: "Autolight Pe Home Bedroom 3A"
    trigger:
      - platform: time
        at: '23:00:01'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: scene.turn_on
        entity_id: scene.bedroom_night

  - alias: "Autolight Pe Home Bedroom 3B"
    trigger:
      - platform: time
        at: '23:45:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: light.turn_off
        entity_id: light.bedroom_3
      - service: light.turn_off
        entity_id: light.bedroom_lc

  - alias: "Autolight Pe Home Bedroom 4A"
    trigger:
      - platform: time
        at: '00:01:01'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: light.turn_on
        entity_id: light.pandora

  - alias: "Autolight Pe Home Bedroom 4B"
    trigger:
      - platform: time
        at: '02:15:00'
    condition:
      - condition: template
        value_template: '{{ is_state("input_select.homemode", "Home") and is_state("input_boolean.presence_pe", "on") }}'
    action:
      - service: light.turn_off
        entity_id: light.pandora

  - alias: "Auto off Welcome light Pe"
    trigger:
      - platform: state
        entity_id: input_boolean.presence_pe
        from: 'off'
        to: 'on'
        for:
          minutes: 5
    condition:
      # - condition: template
      #   value_template: '{{ (is_state("light.hallway", "on") and is_state_attr("light.hallway", "xy_color", "0.6203,0.2925")) and (is_state("light.lightstrip", "on") and is_state_attr("light.lightstrip", "xy_color", "0.6031,0.3046")) }}'
      - condition: template
        value_template: '{{ is_state("light.hallway", "on") and is_state("light.lightstrip", "on") }}'
    action:
      - service_template: '{% if is_state("sun.sun", "above_horizon") %}light.turn_off{% else %}light.turn_on{% endif %}'
        data:
          entity_id: light.lightstrip
          transition: 1
          brightness: 200
          xy_color: [0.1794, 0.0964]
      - service_template: '{% if is_state("sun.sun", "above_horizon") %}light.turn_off{% else %}light.turn_on{% endif %}'
        data:
          entity_id: light.hallway
          transition: 1
          brightness: 200
          xy_color: [0.2951,0.2930]

  - alias: "Auto off Welcome light Jue"
    trigger:
      - platform: state
        entity_id: input_boolean.presence_jue
        from: 'off'
        to: 'on'
        for:
          minutes: 5
    condition:
      # - condition: template
      #   value_template: '{{ is_state("light.hallway", "on") and is_state_attr("light.hallway", "xy_color", "0.6203,0.2925") }}'
      - condition: template
        value_template: '{{ is_state("light.hallway", "on") }}'
    action:
      - service_template: '{% if is_state("sun.sun", "above_horizon") %}light.turn_off{% else %}light.turn_on{% endif %}'
        data:
          entity_id: light.hallway
          transition: 1
          brightness: 200
          kelvin: 7000
