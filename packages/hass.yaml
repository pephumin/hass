# switch:
#   - platform: mqtt
#     state_topic: "homeassistant/restart_hass"
#     command_topic: "homeassistant/restart_hass"
#     name: "Restart Home Assistant"
#     qos: 0
#     payload_on: "ON"
#     payload_of: "OFF"
#     optimistic: false

# script:
#   restart_hass:
#     sequence:
#       - service: script.notify_pesiphone6
#         data:
#           title: "Philips Hue is not found, restarting hass"
#           message: 'Philips Hue is not found, restarting hass [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#       - service: script.flashing_once
#         data:
#           title: "Philips Hue is not found, restarting hass"
#           message: 'Philips Hue is not found, restarting hass [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#       - service: switch.turn_on
#         data:
#           entity_id: switch.restart_home_assistant

# automation:
#
#   - alias: "Restart HA when Hue is not found"
#     trigger:
#       - platform: state
#         entity_id: binary_sensor.moon
#         from: 'on'
#         to: 'off'
#         for:
#           minutes: 15
#     # condition:
#     #   - condition: state
#     #     entity_id: script.restart_hass
#     #     state: 'off'
#     action:
#       - service: homeassistant.restart
#       - service: script.flashing_short
#         data:
#           title: "Restarting HA as Hue is not found"
#           message: 'Restarting HA as Hue is not found for 15 minutes [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#       # - service: homeassistant.turn_on
#       #   entity_id: script.restart_hass
#       # - service: script.notify_pesiphone6
#       #   data:
#       #     title: "Turn on restarting script for hass"
#       #     message: 'Turn on restarting script for hass [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#
#   # - alias: 'Restarting hass'
#   #   trigger:
#   #     - platform: state
#   #       entity_id: switch.restart_home_assistant
#   #       to: 'on'
#   #   # condition:
#   #   #   - condition: time
#   #   #     after: '00:01:00'
#   #   #     before: '23:59:00'
#   #   action:
#   #     - service: homeassistant.restart
#   #     - service: script.notify_pesiphone6
#   #       data:
#   #         title: "Restarting hass"
#   #         message: 'Restarting hass [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#   #
#   # - alias: 'Stop restarting hass is Hue is found'
#   #   trigger:
#   #     - platform: template
#   #       value_template: '{% if is_state("binary_sensor.moon", "on") %}true{% else %}false{% endif %}'
#   #   condition:
#   #     - condition: state
#   #       entity_id: script.restart_hass
#   #       state: 'on'
#   #   action:
#   #     - service: homeassistant.turn_off
#   #       entity_id: script.restart_hass
#   #     - service: script.notify_pesiphone6
#   #       data:
#   #         title: "Found Philips Hue, cancel restarting hass"
#   #         message: 'Found Philips Hue, cancel restarting hass [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#
#   # - alias: 'Restarting HA'
#   #   trigger:
#   #     - platform: time
#   #       hours: '/4'
#   #       minutes: 0
#   #       seconds: 0
#   #   # condition:
#   #   #   - condition: template
#   #   #     value_template: '{{ now().date() | string == "2017-05-11" }}'
#   #   action:
#   #     - service: homeassistant.restart
#   #     - service: script.notifying
#   #       data:
#   #         title: "Restarting HA"
#   #         message: 'Restarting HA every 4 hours [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#
#   - alias: 'Auto-reboot HA 1'
#     trigger:
#       - platform: time
#         at: '00:00:00'
#     # condition:
#     #   - condition: template
#     #     value_template: '{{ now().date() | string == "2017-05-11" }}'
#     action:
#       - service: homeassistant.restart
#       - service: script.notifying
#         data:
#           title: "Restarting HA 1"
#           message: 'Restarting HA at 00:00am everyday [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#
#   - alias: 'Auto-reboot HA 2'
#     trigger:
#       - platform: time
#         at: '08:00:00'
#     action:
#       - service: homeassistant.restart
#       - service: script.notifying
#         data:
#           title: "Restarting HA 2"
#           message: 'Restarting HA at 08:00am everyday [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
#
#   - alias: 'Auto-reboot HA 3'
#     trigger:
#       - platform: time
#         at: '16:00:00'
#     action:
#       - service: homeassistant.restart
#       - service: script.notifying
#         data:
#           title: "Restarting HA 3"
#           message: 'Restarting HA at 16:00pm everyday [{{now().strftime("%d.%m.%y")}} {{now().strftime("%H:%M")}}]'
