binary_sensor:
  - platform: ping
    host: 192.168.1.1
    name: "Deeper"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.2
    name: "Pluto"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.3
    name: "Sun"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.4
    name: "Uranus"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.5
    name: "Neptune"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.6
    name: "Mercury"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.7
    name: "Apollo"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.9
    name: "Kepler"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.10
    name: "Cookie"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.11
    name: "Doughnut"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.12
    name: "Biscuit"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.13
    name: "Candy"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.14
    name: "Broadlink RM Mini A"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.15
    name: "Broadlink RM Mini B"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.16
    name: "Broadlink RM Mini C"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.17
    name: "Broadlink RM Mini D"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.18
    name: "Hyperion"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.19
    name: "Charon"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.120
    name: "Titan"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.121
    name: "Europa"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.22
    name: "Ganymede"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.23
    name: "Callisto"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.24
    name: "Mimas"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.25
    name: "Pandora"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.26
    name: "Phoebe"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.27
    name: "Calypso"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.28
    name: "SVA"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.29
    name: "SVB"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.30
    name: "pesiphone13pro"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.31
    name: "pesipadpro"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.32
    name: "juesiphonexsmax"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.33
    name: "juesipadmini4"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.34
    name: "pesipodtouch4"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.36
    name: "benjysiphone11"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.37
    name: "benjysipadmini5"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.38
    name: "benjawan"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.39
    name: "boom"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.40
    name: "Moon"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.41
    name: "Comet"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.42
    name: "NodeMCU Matrix Clock"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.43
    name: "Wemos Ring Clock"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.44
    name: "Earth"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.45
    name: "XDJRX"
    count: 2
    scan_interval: 120
  # - platform: ping
  #   host: 192.168.1.46
  #   name: "Comet"
  #   count: 2
  #   scan_interval: 120
  - platform: ping
    host: 192.168.1.52
    name: "RoundClock"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.53
    name: "Pong"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.55
    name: "Apple_TV"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.56
    name: "RocketM5"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.57
    name: "NanoBeamM5"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.58
    name: "ANanoBridgeM5"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.59
    name: "BulletM5"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.60
    name: "RocketM2"
    count: 2
    scan_interval: 120
  # - platform: ping
  #   host: 192.168.1.61
  #   name: "Wemos WLED RC"
  #   count: 2
  #   scan_interval: 120
  # - platform: ping
  #   host: 192.168.1.62
  #   name: "Wemos WLED B"
  #   count: 2
  #   scan_interval: 120
  - platform: ping
    host: 192.168.1.63
    name: "Wemos WLED SA"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.64
    name: "Wemos WLED SB"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.65
    name: "Wemos WLED Party"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.66
    name: "Denon"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.67
    name: "Homepod Mini"
    count: 2
    scan_interval: 120
  # - platform: ping
  #   host: 192.168.1.67
  #   name: ""
  #   count: 2
  #   scan_interval: 120
  - platform: ping
    host: 192.168.1.69
    name: "Downlight Black1"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.70
    name: "Downlight Black2"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.71
    name: "Downlight Black3"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.72
    name: "Downlight Black4"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.73
    name: "Downlight Black5"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.74
    name: "Downlight Black6"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.75
    name: "Downlight Black7"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.76
    name: "Downlight Black8"
    count: 2
    scan_interval: 120
  # - platform: ping
  #   host: 192.168.1.72
  #   name: "Smart Dimmer"
  #   count: 2
  #   scan_interval: 120
  - platform: ping
    host: 192.168.1.77
    name: "Dune"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.78
    name: "Foscam Black"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.79
    name: "Foscam White"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.80
    name: "Foscam R2"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.81
    name: "BoxieB1"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.82
    name: "BoxieB2"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.83
    name: "ESP32 Cam"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.86
    name: "SmartTV"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.87
    name: "pSat"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.88
    name: "Android_Box"
    count: 2
    scan_interval: 120
  # - platform: ping
  #   host: 192.168.1.89
  #   name: ""
  #   count: 2
  #   scan_interval: 120
  - platform: ping
    host: 192.168.1.90
    name: "Solar"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.95
    name: "Wemos WLED SC"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.96
    name: "Wemos WLED SD"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.97
    name: "Wemos WLED Olympic"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.99
    name: "Jupiter"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.100
    name: "Saturn"
    count: 2
    scan_interval: 120
  - platform: ping
    host: 192.168.1.200
    name: "pepe-"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.202
    name: "pepe-work"
    count: 2
    scan_interval: 30
  - platform: ping
    host: 192.168.1.250
    name: "pepe"
    count: 2
    scan_interval: 30

input_boolean:
  presence_xdjrx:
    name: "XDJ-RX online"
    initial: off
    icon: mdi:music
  presence_pong:
    name: "Pong online"
    initial: off
    icon: mdi:car

automation:

  - alias: 'Common Room Online Switch Restart'
    initial_state: "on"
    trigger:
      - platform: state
        entity_id: binary_sensor.broadlink_rm_mini_b, binary_sensor.boxieb2, binary_sensor.candy
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: template
        value_template: '{% if state_attr("automation.common_room_online_switch_restart", "last_triggered") == none %}{{ (as_timestamp(now())-as_timestamp(states.automation.common_room_online_switch_restart.last_updated)) > 600 }}{% else %}{{ (as_timestamp(now())-as_timestamp(state_attr("automation.common_room_online_switch_restart", "last_triggered"))) > 600 }}{% endif %}'
    action:
      - service: script.turn_on
        entity_id: script.restart_callisto
      - service: counter.increment
        entity_id: counter.commonroom
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "true"
          audio: "false"
          light: "false"
          mobile: "pe"
          title: "Restarting Common Room Online Switch (Callisto)"
          message: 'Camera Online Switch (Callisto) was restarted because {{ trigger.from_state.attributes.friendly_name }} was detected as being {{ trigger.to_state.state }}line for 5 minutes'

  - alias: 'WLED Online Switch Restart'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.wemos_wled_sa, binary_sensor.wemos_wled_sb, binary_sensor.wemos_wled_party
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: template
        value_template: '{% if state_attr("automation.wled_online_switch_restart", "last_triggered") == none %}{{ (as_timestamp(now())-as_timestamp(states.automation.wled_online_switch_restart.last_updated)) > 600 }}{% else %}{{ (as_timestamp(now())-as_timestamp(state_attr("automation.wled_online_switch_restart", "last_triggered"))) > 600 }}{% endif %}'
    action:
      - service: script.turn_on
        entity_id: script.restart_ganymede
      - service: counter.increment
        entity_id: counter.wled
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "true"
          audio: "false"
          light: "false"
          mobile: "pe"
          title: "Restarting WLED Online Switch (Ganymede)"
          message: 'WLED Online Switch (Ganymede) was restarted because {{ trigger.from_state.attributes.friendly_name }} was detected as being {{ trigger.to_state.state }}line for 5 minutes'

  - alias: 'WLED2 Online Switch Restart'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.wemos_wled_ba, binary_sensor.wemos_wled_bb
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: template
        value_template: '{% if state_attr("automation.wled2_online_switch_restart", "last_triggered") == none %}{{ (as_timestamp(now())-as_timestamp(states.automation.wled2_online_switch_restart.last_updated)) > 600 }}{% else %}{{ (as_timestamp(now())-as_timestamp(state_attr("automation.wled2_online_switch_restart", "last_triggered"))) > 600 }}{% endif %}'
    action:
      - service: script.turn_on
        entity_id: script.restart_sva
      - service: counter.increment
        entity_id: counter.wled2
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "true"
          audio: "false"
          light: "false"
          mobile: "pe"
          title: "Restarting WLED2 Online Switch (SVA)"
          message: 'WLED2 Online Switch (SVA) was restarted because {{ trigger.from_state.attributes.friendly_name }} was detected as being {{ trigger.to_state.state }}line for 5 minutes'

  - alias: 'Bedroom2 Online Switch Restart'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.broadlink_rm_mini_d
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: template
        value_template: '{% if state_attr("automation.bedroom2_online_switch_restart", "last_triggered") == none %}{{ (as_timestamp(now())-as_timestamp(states.automation.bedroom2_online_switch_restart.last_updated)) > 600 }}{% else %}{{ (as_timestamp(now())-as_timestamp(state_attr("automation.bedroom2_online_switch_restart", "last_triggered"))) > 600 }}{% endif %}'
    action:
      - service: script.turn_on
        entity_id: script.restart_charon
      - service: counter.increment
        entity_id: counter.bedroom2
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "true"
          audio: "false"
          light: "false"
          mobile: "pe"
          title: "Restarting Bedroom2 Online Switch (Charon)"
          message: 'WLED2 Online Switch (Charon) was restarted because {{ trigger.from_state.attributes.friendly_name }} was detected as being {{ trigger.to_state.state }}line for 5 minutes'

  - alias: 'Bedroom Online Switch Restart'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.neptune, binary_sensor.broadlink_rm_mini_a, binary_sensor.doughnut, inary_sensor.kepler
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: template
        value_template: '{% if state_attr("automation.bedroom_online_switch_restart", "last_triggered") == none %}{{ (as_timestamp(now())-as_timestamp(states.automation.bedroom_online_switch_restart.last_updated)) > 600 }}{% else %}{{ (as_timestamp(now())-as_timestamp(state_attr("automation.bedroom_online_switch_restart", "last_triggered"))) > 600 }}{% endif %}'
    action:
      - service: script.turn_on
        entity_id: script.restart_hyperion
      - service: counter.increment
        entity_id: counter.bedroom
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "true"
          audio: "false"
          light: "false"
          mobile: "pe"
          title: "Restarting Bedroom online switch (Hyperion)"
          message: 'Bedroom Online Switch (Hyperion) was restarted because {{ trigger.from_state.attributes.friendly_name }} was detected as being {{ trigger.to_state.state }}line for 5 minutes'

  - alias: 'First Floor Online Switch Restart'
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.boxieb1, binary_sensor.earth
        to: "off"
        for:
          minutes: 5
    condition:
      - condition: template
        value_template: '{% if state_attr("automation.first_floor_online_switch_restart", "last_triggered") == none %}{{ (as_timestamp(now())-as_timestamp(states.automation.first_floor_online_switch_restart.last_updated)) > 600 }}{% else %}{{ (as_timestamp(now())-as_timestamp(state_attr("automation.first_floor_online_switch_restart", "last_triggered"))) > 600 }}{% endif %}'
    action:
      - service: script.turn_on
        entity_id: script.restart_phoebe
      - service: counter.increment
        entity_id: counter.firstfloor
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "true"
          audio: "false"
          light: "false"
          mobile: "pe"
          title: "Restarting First Floor online switch (Phoebe)"
          message: 'First Floor Online Switch (Phoebe) was restarted because {{ trigger.from_state.attributes.friendly_name }} was detected as being {{ trigger.to_state.state }}line for 5 minutes'

  - alias: "Car Online"
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.pong
        from: 'off'
        to: 'on'
    condition:
      - condition: template
        value_template: '{{ is_state("light.white_garage", "off") and is_state("sun.sun", "below_horizon") }}'
    action:
      - service: light.turn_on
        entity_id: light.white_garage
      - service: input_boolean.turn_on
        entity_id: input_boolean.presence_pong
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          message: 'Turn on Garage Light because {{ trigger.from_state.attributes.friendly_name }} gets online'

  - alias: "Car Offline"
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: binary_sensor.pong
        from: 'on'
        to: 'off'
        for:
          minutes: 1
    condition:
      - condition: template
        value_template: '{{ is_state("light.white_garage", "on") }}'
    action:
      - service: light.turn_off
        entity_id: light.white_garage
      - service: input_boolean.turn_off
        entity_id: input_boolean.presence_pong
      - service: script.notifying
        data_template:
          email: "false"
          tv: "true"
          line: "false"
          speak: "false"
          audio: "chime"
          light: "false"
          mobile: "pe"
          message: 'Turn off Garage Light because {{ trigger.from_state.attributes.friendly_name }} has gone offline'

  - alias: "XDJ-RX is online"
    initial_state: 'on'
    trigger:
      - platform: template
        value_template: '{{ is_state("binary_sensor.xdjrx", "on") }}'
    condition:
      - condition: template
        value_template: '{{ is_state("input_boolean.presence_xdjrx", "off") }}'
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.presence_xdjrx
      - service: script.notifying
        data_template:
          email: "true"
          tv: "true"
          line: "true"
          speak: "true"
          audio: "pip"
          light: "false"
          mobile: "pe"
          message: "XDJ-RX has been turned on!"

  - alias: "XDJ-RX is offline"
    initial_state: 'on'
    trigger:
      - platform: template
        value_template: '{{ is_state("binary_sensor.xdjrx", "off") }}'
    condition:
      - condition: template
        value_template: '{{ is_state("input_boolean.presence_xdjrx", "on") }}'
    action:
      - service: input_boolean.turn_off
        entity_id: input_boolean.presence_xdjrx
      - service: script.notifying
        data_template:
          email: "true"
          tv: "true"
          line: "true"
          speak: "true"
          audio: "pip"
          light: "false"
          mobile: "pe"
          message: "XDJ-RX has been turned off!"

  # - alias: "XDJ-RX is on"
  #   initial_state: "on"
  #   trigger:
  #     - platform: state
  #       entity_id: input_boolean.presence_xdjrx
  #       from: 'off'
  #       to: 'on'
  #       for:
  #         minutes: 1
  #         seconds: 30
  #   condition:
  #     - condition: template
  #       value_template: '{{ is_state("binary_sensor.xdjrx", "on") }}'
  #   action:
  #     - service: script.notifying
  #       data_template:
  #         email: "true"
  #         tv: "true"
  #         line: "true"
  #         speak: "true"
  #         audio: "pip"
  #         light: "false"
  #         mobile: "pe"
  #         message: "XDJ-RX has been turned on!"

  # - alias: "XDJ-RX is off"
  #   initial_state: "on"
  #   trigger:
  #     - platform: state
  #       entity_id: input_boolean.presence_xdjrx
  #       from: 'on'
  #       to: 'off'
  #       for:
  #         minutes: 1
  #         seconds: 30
  #   condition:
  #     - condition: template
  #       value_template: '{{ is_state("binary_sensor.xdjrx", "off") }}'
  #   action:
  #     - service: script.notifying
  #       data_template:
  #         email: "true"
  #         tv: "true"
  #         line: "true"
  #         speak: "true"
  #         audio: "pip"
  #         light: "false"
  #         mobile: "pe"
  #         message: "XDJ-RX has been turned off!"
